---
import "../styles/global.css";
import { Image } from "astro:assets";

import flowersImage from '../assets/tulipanes-amarillos.png';

const pageTitle = "Para Sis Cosharon üåª";
const date = "21 de Septiembre";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>{pageTitle}</title>
  </head>
  <body>
    <div class="falling-flowers" id="fallingFlowers"></div>

    <div class="card">
      <div class="header">
        <h1>Feliz D√≠a de las<br />Flores Amarillas</h1>
        <div class="date">{date}</div>
      </div>

      <button class="music-btn" id="musicBtn" aria-label="Reproducir m√∫sica"
        >‚ô™</button
      >

      <div class="photo-frame">
		<Image src={flowersImage} alt="Tulipanes Amarillos" />
      </div>

      <p class="message" style="animation-delay: 0.3s;">
        Las flores amarillas brillan con la luz que t√∫ llevas dentro...
      </p>

      <p class="message" style="animation-delay: 0.6s;">
        Con estas flores, iluminas cada rinc√≥n de mi vida con tu alegr√≠a y
        calidez.
      </p>

      <button class="main-btn" id="mainBtn">üå∏ Decubre Mi Mensaje</button>

      <div class="signature">Para ti, con cari√±o, Corashono</div>
    </div>

    <div class="modal" id="letterModal">
      <button class="close-btn" id="closeBtn" aria-label="Cerrar">√ó</button>
      <div class="modal-content">
        <div class="torn-paper">
          <h2 class="letter-title">Para Ti en Este D√≠a Especial</h2>

          <div class="letter-content">
            <p>Corashona,</p>
            <p>
              No conoc√≠a de este D√≠a de las Flores Amarillas, pero investigue y
              quiero dedicarte estas palabras as√≠ como se dedican estas flores,
              aunque no sean f√≠sicas, te las mando de coraz√≥n.
            </p>
            <p>
              Las flores amarillas simbolizan amistad, felicidad y nuevos
              comienzos. Y no puedo pensar en mejor manera de celebrar lo que
              significas para m√≠.
            </p>
            <p>
              Recuerdo cada momento compartido contigo, siempre las risas, las
              burlas entre los dos. Tu risa me encanta, y a tu manera de
              demostrarme tu apoyo, siempre he amado cada detalle y sacrificio
              que has hecho para este rarito friki como yo. Te amo en cada
              faceta tuya, y siempre lo har√©, porque yo te eleg√≠.
            </p>
          </div>          
        </div>

        <div class="letter-signature">Con aprecio, Mr. Sam (Corashono)</div>
      </div>
    </div>
  </body>

  <script is:inline>
    document.addEventListener("DOMContentLoaded", function () {
      // DOM ELEMENTS
      const fallingFlowers = document.getElementById("fallingFlowers");
      const mainBtn = document.getElementById("mainBtn");
      const letterModal = document.getElementById("letterModal");
      const closeBtn = document.getElementById("closeBtn");
      const musicBtn = document.getElementById("musicBtn");

      const flowerSymbols = ["üåª", "üåº", "üå∏", "üíê", "üå∫", "üå∑"];

      function createFallingFlowers() {
        const flower = document.createElement("div");
        flower.className = "flower";
        flower.innerHTML =
          flowerSymbols[Math.floor(Math.random() * flowerSymbols.length)];
        flower.style.left = Math.random() * 100 + "vw";
        flower.style.animationDuration = 5 + Math.random() * 10 + "s";
        flower.style.animationName =
          Math.random() > 0.5 ? "fall" : "gentle-sway";
        flower.style.opacity = Math.random() * 0.5 + 0.3;
        flower.style.fontSize = 16 + Math.random() * 24 + "px";
        fallingFlowers.appendChild(flower);

        setTimeout(() => {
          flower.remove();
        }, 15000);
      }

      // INITIALIZE FALLING FLOWERS
      setInterval(createFallingFlowers, 300);

      const audio = new Audio("https://bcodestorague.anteroteobaldob.workers.dev/share/anteroteobaldob_gmail_com/AUDIO/those%20eyes%20.mp3");
      audio.loop = true;
      let isPlaying = false;

      // Controlar audio
      function toggleAudio() {
        if (isPlaying) {
          audio.pause();
          musicBtn.textContent = "‚ô™";
          musicBtn.setAttribute("aria-label", "Reproducir m√∫sica");
        } else {
          audio
            .play()
            .catch((e) =>
              console.log(
                "La reproducci√≥n autom√°tica fue prevenida. Haz clic manualmente."
              )
            );
          musicBtn.textContent = "‚ùö‚ùö";
          musicBtn.setAttribute("aria-label", "Pausar m√∫sica");
        }
        isPlaying = !isPlaying;
      }

      // Event listeners
      musicBtn.addEventListener("click", toggleAudio);

      mainBtn.addEventListener("click", function () {
        letterModal.style.display = "flex";
        document.body.style.overflow = "hidden";

        // Efecto de explosi√≥n de flores
        for (let i = 0; i < 20; i++) {
          setTimeout(() => {
            createFlowerExplosion();
          }, i * 100);
        }

        // Reproducir audio si no est√° reproduciendo
        if (!isPlaying) {
          toggleAudio();
        }
      });
    });

    closeBtn.addEventListener("click", function () {
      letterModal.style.display = "none";
      document.body.style.overflow = "auto";
    });

    window.addEventListener("click", function (event) {
      if (event.target === letterModal) {
        letterModal.style.display = "none";
        document.body.style.overflow = "auto";
      }
    });

    // Crear explosi√≥n de flores
    function createFlowerExplosion() {
      const explosion = document.createElement("div");
      explosion.innerHTML =
        flowerSymbols[Math.floor(Math.random() * flowerSymbols.length)];
      explosion.style.position = "fixed";
      explosion.style.left = Math.random() * 100 + "vw";
      explosion.style.top = Math.random() * 100 + "vh";
      explosion.style.color = `hsl(${Math.random() * 20 + 45}, 100%, 60%)`;
      explosion.style.fontSize = "28px";
      explosion.style.zIndex = "100";
      explosion.style.pointerEvents = "none";
      explosion.style.transform = "scale(0)";
      explosion.style.animation = `flower-pop 0.5s forwards, flower-fade 0.5s 1s forwards`;

      document.body.appendChild(explosion);

      setTimeout(() => {
        explosion.remove();
      }, 1500);
    }

    // Prevenir zoom en doble tap en dispositivos m√≥viles
    document.addEventListener(
      "dblclick",
      function (e) {
        e.preventDefault();
      },
      { passive: false }
    );

    // Agregar estilos para animaciones
    const style = document.createElement("style");
    style.textContent = `
              @keyframes flower-pop {
                  0% { transform: scale(0); opacity: 0; }
                  50% { transform: scale(1.2); opacity: 1; }
                  100% { transform: scale(1); opacity: 0.8; }
              }
              @keyframes flower-fade {
                  to { opacity: 0; transform: translateY(-20px) rotate(45deg); }
              }
          `;
    document.head.appendChild(style);

    // Intento de reproducci√≥n autom√°tica con gesto del usuario
    function tryAutoPlay() {
      if (!isPlaying) {
        audio
          .play()
          .then(() => {
            musicBtn.textContent = "‚ùö‚ùö";
            musicBtn.setAttribute("aria-label", "Pausar m√∫sica");
            isPlaying = true;
          })
          .catch((e) => console.log("Autoplay bloqueado por el navegador."));
      }
    }

    // Intentar reproducci√≥n con la primera interacci√≥n
    ["click", "touchstart", "keydown"].forEach((event) => {
      document.addEventListener(event, tryAutoPlay, { once: true });
    });
  </script>
</html>
